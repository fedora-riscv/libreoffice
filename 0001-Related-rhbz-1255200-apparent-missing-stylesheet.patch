From aa2ae6a979c494f1aa6ce534c49edf2763ccb3e0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
Date: Tue, 1 Sep 2015 12:45:03 +0100
Subject: [PATCH] Related: rhbz#1255200 apparent missing stylesheet

Change-Id: Ice9a860ca839d37308b5c2f2eb639852fefe1d15
(cherry picked from commit dcb0738b631c61999364bd8500f401f93bbfb84e)
---
 svx/source/table/tablecontroller.cxx | 17 +++++++++++------
 1 file changed, 11 insertions(+), 6 deletions(-)

diff --git a/svx/source/table/tablecontroller.cxx b/svx/source/table/tablecontroller.cxx
index 38a41b5..64b40da 100644
--- a/svx/source/table/tablecontroller.cxx
+++ b/svx/source/table/tablecontroller.cxx
@@ -1081,14 +1081,19 @@ void SvxTableController::SetTableStyle( const SfxItemSet* pArgs )
                     {
                         SfxItemSet aSet( xCell->GetItemSet() );
                         bool bChanges = false;
-                        const SfxItemSet& rStyleAttribs = xCell->GetStyleSheet()->GetItemSet();
-
-                        for ( sal_uInt16 nWhich = SDRATTR_START; nWhich <= SDRATTR_TABLE_LAST; nWhich++ )
+                        SfxStyleSheet *pStyleSheet = xCell->GetStyleSheet();
+                        SAL_WARN_IF(!pStyleSheet, "svx", "no stylesheet for table cell?");
+                        if (pStyleSheet)
                         {
-                            if( (rStyleAttribs.GetItemState( nWhich ) == SfxItemState::SET) && (aSet.GetItemState( nWhich ) == SfxItemState::SET) )
+                            const SfxItemSet& rStyleAttribs = pStyleSheet->GetItemSet();
+
+                            for ( sal_uInt16 nWhich = SDRATTR_START; nWhich <= SDRATTR_TABLE_LAST; nWhich++ )
                             {
-                                aSet.ClearItem( nWhich );
-                                bChanges = true;
+                                if( (rStyleAttribs.GetItemState( nWhich ) == SfxItemState::SET) && (aSet.GetItemState( nWhich ) == SfxItemState::SET) )
+                                {
+                                    aSet.ClearItem( nWhich );
+                                    bChanges = true;
+                                }
                             }
                         }
 
-- 
2.4.0

