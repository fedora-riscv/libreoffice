From 0497864bd4f603605997938d504ef9598623e713 Mon Sep 17 00:00:00 2001
From: David Tardon <dtardon@redhat.com>
Date: Fri, 25 Jul 2014 15:40:27 +0200
Subject: [PATCH] rhbz#1121254 reload font list from shell on change

Change-Id: Ief88373c210b3b6f65c1df5b31870aca561095bb
---
 svx/source/tbxctrls/tbcontrl.cxx | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/svx/source/tbxctrls/tbcontrl.cxx b/svx/source/tbxctrls/tbcontrl.cxx
index 816afbe..5728791 100644
--- a/svx/source/tbxctrls/tbcontrl.cxx
+++ b/svx/source/tbxctrls/tbcontrl.cxx
@@ -891,6 +891,12 @@ void SvxFontNameBox_Impl::DataChanged( const DataChangedEvent& rDCEvt )
         Size aDropSize( aLogicalSize.Width(), LOGICAL_EDIT_HEIGHT);
         SetDropDownSizePixel(LogicToPixel(aDropSize, MAP_APPFONT));
     }
+    else if ( rDCEvt.GetType() == DATACHANGED_FONTS )
+    {
+        // The old font list in shell has likely been destroyed at this point, so we need to get
+        // the new one before doing anything further.
+        lcl_GetDocFontList( &pFontList, this );
+    }
 
     FontNameBox::DataChanged( rDCEvt );
 }
-- 
1.9.3

