From 4c4a56255510a8044cdb169d6f3c6c5ed015ee27 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
Date: Fri, 30 Sep 2016 15:56:44 +0100
Subject: [PATCH] rhbz#1353069 don't record undo information in the clipboard
 document

Change-Id: Ib1c5cbcaa2f1a2abc53ab66993af8a5adfd7ca59
---
 sd/source/ui/app/sdxfer.cxx | 6 ++++++
 sd/source/ui/inc/sdxfer.hxx | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/sd/source/ui/app/sdxfer.cxx b/sd/source/ui/app/sdxfer.cxx
index 27b8aab..6d6d82d 100644
--- a/sd/source/ui/app/sdxfer.cxx
+++ b/sd/source/ui/app/sdxfer.cxx
@@ -689,6 +689,12 @@ void SdTransferable::ObjectReleased()
         SD_MOD()->pTransferSelection = nullptr;
 }
 
+void SdTransferable::SetWorkDocument(const SdDrawDocument* pWorkDoc)
+{
+    mpSdDrawDocument = mpSdDrawDocumentIntern = const_cast<SdDrawDocument*>(pWorkDoc);
+    mpSdDrawDocument->EnableUndo(false);
+}
+
 void SdTransferable::SetObjectDescriptor( const TransferableObjectDescriptor& rObjDesc )
 {
     delete mpObjDesc;
diff --git a/sd/source/ui/inc/sdxfer.hxx b/sd/source/ui/inc/sdxfer.hxx
index ba00241..5ba767e 100644
--- a/sd/source/ui/inc/sdxfer.hxx
+++ b/sd/source/ui/inc/sdxfer.hxx
@@ -47,7 +47,7 @@ public:
     void                            SetDocShell( const SfxObjectShellRef& rRef ) { maDocShellRef = rRef; }
     const SfxObjectShellRef&        GetDocShell() const { return maDocShellRef; }
 
-    void                            SetWorkDocument( const SdDrawDocument* pWorkDoc ) { mpSdDrawDocument = mpSdDrawDocumentIntern = const_cast<SdDrawDocument*>(pWorkDoc); }
+    void                            SetWorkDocument(const SdDrawDocument* pWorkDoc);
     const SdDrawDocument*           GetWorkDocument() const { return mpSdDrawDocument; }
 
     void                            SetView(const ::sd::View* pView);
-- 
2.7.4

