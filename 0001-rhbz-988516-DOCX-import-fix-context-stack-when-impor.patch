From 155397041b1a5687259605de1e33ed86ed955821 Mon Sep 17 00:00:00 2001
From: Michael Stahl <mstahl@redhat.com>
Date: Wed, 5 Mar 2014 23:29:06 +0100
Subject: [PATCH] rhbz#988516: DOCX import: fix context stack when importing
 header/footer

When a header/footer substream is parsed, a ParagraphGroup is started,
but not ended; so the properties of the last paragraph in the
header/footer are applied to a paragraph in the body.

The obvious fix to add a call to endParagraphGroup() at the end of w:p
element breaks table cells.  So add a call to endParagraphGroup() at
the end of the "hdr"/"ftr" element.

(The problem in the bugdoc became much more visible with commit
ca555c596043c88894b964ac5e21f5a7271d5f3b, but was there before)

(cherry picked from commit 2b78f2cd7b9e4bab0f3b3b9119238f36a1bbc7b2)

Conflicts:
	sw/qa/extras/ooxmlimport/ooxmlimport.cxx

Change-Id: Ib054f1882793049b39424c1076ba5d4b319cd027
Reviewed-on: https://gerrit.libreoffice.org/8476
Reviewed-by: Miklos Vajna <vmiklos@collabora.co.uk>
Tested-by: Miklos Vajna <vmiklos@collabora.co.uk>
---
 sw/qa/extras/ooxmlimport/data/rhbz988516.docx | Bin 0 -> 15513 bytes
 sw/qa/extras/ooxmlimport/ooxmlimport.cxx      |  14 ++++++++++++++
 writerfilter/source/ooxml/model.xml           |   4 +++-
 3 files changed, 17 insertions(+), 1 deletion(-)
 create mode 100644 sw/qa/extras/ooxmlimport/data/rhbz988516.docx

diff --git a/sw/qa/extras/ooxmlimport/data/rhbz988516.docx b/sw/qa/extras/ooxmlimport/data/rhbz988516.docx
new file mode 100644
index 0000000000000000000000000000000000000000..38e2dcff324036a333060f10475fa60a6c872074
GIT binary patch
literal 15513
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
JJIAkI{|EA+bCm!9

literal 0
HcmV?d00001

diff --git a/sw/qa/extras/ooxmlimport/ooxmlimport.cxx b/sw/qa/extras/ooxmlimport/ooxmlimport.cxx
index dee45c9..9a35a3e 100644
--- a/sw/qa/extras/ooxmlimport/ooxmlimport.cxx
+++ b/sw/qa/extras/ooxmlimport/ooxmlimport.cxx
@@ -139,6 +139,7 @@ public:
     void testRPrChangeClosed();
     void testFdo65090();
     void testFdo73389();
+    void testRhbz988516();
 
     CPPUNIT_TEST_SUITE(Test);
 #if !defined(MACOSX) && !defined(WNT)
@@ -243,6 +244,7 @@ void Test::run()
         {"rprchange_closed.docx", &Test::testRPrChangeClosed},
         {"fdo65090.docx", &Test::testFdo65090},
         {"fdo73389.docx", &Test::testFdo73389},
+        {"rhbz988516.docx", &Test::testRhbz988516},
     };
     header();
     for (unsigned int i = 0; i < SAL_N_ELEMENTS(aMethods); ++i)
@@ -376,6 +378,18 @@ void Test::testN757890()
     CPPUNIT_ASSERT_EQUAL(text::HoriOrientation::CENTER, nValue);
 }
 
+void Test::testRhbz988516()
+{
+    // The problem was that the list properties of the footer leaked into body
+    CPPUNIT_ASSERT_EQUAL(OUString(),
+            getProperty<OUString>(getParagraph(1), "NumberingStyleName"));
+    CPPUNIT_ASSERT_EQUAL(OUString("Enclosure 3"), getParagraph(2)->getString());
+    CPPUNIT_ASSERT_EQUAL(OUString(),
+            getProperty<OUString>(getParagraph(2), "NumberingStyleName"));
+    CPPUNIT_ASSERT_EQUAL(OUString(),
+            getProperty<OUString>(getParagraph(3), "NumberingStyleName"));
+}
+
 void Test::testFdo49940()
 {
     uno::Reference<text::XTextDocument> xTextDocument(mxComponent, uno::UNO_QUERY);
diff --git a/writerfilter/source/ooxml/model.xml b/writerfilter/source/ooxml/model.xml
index d368dab..a42ab94 100644
--- a/writerfilter/source/ooxml/model.xml
+++ b/writerfilter/source/ooxml/model.xml
@@ -22508,7 +22508,9 @@
       <element name="headerReference" tokenid="ooxml:EG_HdrFtrReferences_headerReference"/>
       <element name="footerReference" tokenid="ooxml:EG_HdrFtrReferences_footerReference"/>
     </resource>
-    <resource name="CT_HdrFtr" resource="Stream" tag="header"/>
+    <resource name="CT_HdrFtr" resource="Stream" tag="header">
+      <action name="end" action="endParagraphGroup"/>
+    </resource>
     <resource name="EG_SectPrContents" resource="Properties" tag="section">
       <element name="bidi" tokenid="ooxml:EG_SectPrContents_bidi"/>
       <element name="cols" tokenid="ooxml:EG_SectPrContents_cols"/>
-- 
1.8.3.1

