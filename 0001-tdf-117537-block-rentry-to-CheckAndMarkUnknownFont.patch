From c6c82096301180cfa7942dd9fb9d1cb66c7ecc04 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
Date: Thu, 31 May 2018 13:49:40 +0100
Subject: [PATCH] tdf#117537 block rentry to CheckAndMarkUnknownFont

Change-Id: I70e75a39d13e93e929c7aef5407b1100bb2a7c12
Reviewed-on: https://gerrit.libreoffice.org/55131
Tested-by: Jenkins <ci@libreoffice.org>
Reviewed-by: Miklos Vajna <vmiklos@collabora.co.uk>
---
 svx/source/tbxctrls/tbcontrl.cxx | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/svx/source/tbxctrls/tbcontrl.cxx b/svx/source/tbxctrls/tbcontrl.cxx
index 997520fd5e32..c5c19346ce3f 100644
--- a/svx/source/tbxctrls/tbcontrl.cxx
+++ b/svx/source/tbxctrls/tbcontrl.cxx
@@ -192,6 +192,7 @@ private:
     Reference< XDispatchProvider > m_xDispatchProvider;
     Reference< XFrame >            m_xFrame;
     bool            mbEndPreview;
+    bool            mbCheckingUnknownFont;
 
     void            ReleaseFocus_Impl();
     void            EnableControls_Impl();
@@ -970,7 +971,8 @@ SvxFontNameBox_Impl::SvxFontNameBox_Impl( vcl::Window* pParent, const Reference<
     bRelease           ( true ),
     m_xDispatchProvider( rDispatchProvider ),
     m_xFrame (_xFrame),
-    mbEndPreview(false)
+    mbEndPreview(false),
+    mbCheckingUnknownFont(false)
 {
     SetOptimalSize();
     EnableControls_Impl();
@@ -1002,6 +1004,9 @@ IMPL_LINK( SvxFontNameBox_Impl, CheckAndMarkUnknownFont, VclWindowEvent&, event,
 {
     if( event.GetId() != VclEventId::EditModify )
         return;
+    if (mbCheckingUnknownFont) //tdf#117537 block rentry
+        return;
+    mbCheckingUnknownFont = true;
     OUString fontname = GetSubEdit()->GetText();
     lcl_GetDocFontList( &pFontList, this );
     // If the font is unknown, show it in italic.
@@ -1024,6 +1029,7 @@ IMPL_LINK( SvxFontNameBox_Impl, CheckAndMarkUnknownFont, VclWindowEvent&, event,
             SetQuickHelpText( SvxResId( RID_SVXSTR_CHARFONTNAME_NOTAVAILABLE ));
         }
     }
+    mbCheckingUnknownFont = false;
 }
 
 void SvxFontNameBox_Impl::Update( const css::awt::FontDescriptor* pFontDesc )
-- 
2.17.0

