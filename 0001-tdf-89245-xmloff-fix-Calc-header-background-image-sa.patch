From ff27d358cd9a3c9ae8eb7153e00d1b6dde07b850 Mon Sep 17 00:00:00 2001
From: Miklos Vajna <vmiklos@collabora.co.uk>
Date: Mon, 31 Aug 2015 09:05:59 +0200
Subject: [PATCH] tdf#89245 xmloff: fix Calc header background image saving

Regression from commit 7d9bb549d498d6beed2c4050c402d09643febdfa
(Related: #i124638# Second step of DrawingLayer FillAttributes...,
2014-06-02), the problem was that the new
CTF_PM_REPEAT_OFFSET_X..CTF_PM_FILLTRANSNAME range's values overlapped with the
existing CTF_PM_HEADERHEIGHT..CTF_PM_HEADERGRAPHICURL range's values, so
when the new code in XMLPageMasterExportPropMapper::ContextFilter()
tried to tweak header repeat offset properties, it actually disabled
HeaderBackGraphicURL instead.

(cherry picked from commit 3b40329f9a64b93b1e1230b1bff74ed8cda8cd70)

Conflicts:
	sc/qa/unit/subsequent_export-test.cxx

Change-Id: I9c2700fa71a4ef2a813ec671049ee9d98171b57e
Reviewed-on: https://gerrit.libreoffice.org/18162
Reviewed-by: Andras Timar <andras.timar@collabora.com>
Tested-by: Andras Timar <andras.timar@collabora.com>
---
 include/xmloff/PageMasterStyleMap.hxx |  12 ++++++------
 sc/qa/unit/data/ods/header-image.ods  | Bin 0 -> 12036 bytes
 sc/qa/unit/subsequent_export-test.cxx |  16 ++++++++++++++++
 3 files changed, 22 insertions(+), 6 deletions(-)
 create mode 100644 sc/qa/unit/data/ods/header-image.ods

diff --git a/include/xmloff/PageMasterStyleMap.hxx b/include/xmloff/PageMasterStyleMap.hxx
index a4007bd..859f3e0 100644
--- a/include/xmloff/PageMasterStyleMap.hxx
+++ b/include/xmloff/PageMasterStyleMap.hxx
@@ -90,12 +90,12 @@
 // at export time using CTF_PM_FLAGMASK and XML_PM_CTF_START as detector
 // to find the first entry for header/footer (!), see
 // SvXMLAutoStylePoolP_Impl::exportXML, look for XML_STYLE_FAMILY_PAGE_MASTER
-#define CTF_PM_REPEAT_OFFSET_X          (XML_PM_CTF_START + 0x0035)
-#define CTF_PM_REPEAT_OFFSET_Y          (XML_PM_CTF_START + 0x0036)
-#define CTF_PM_FILLGRADIENTNAME         (XML_PM_CTF_START + 0x0037)
-#define CTF_PM_FILLHATCHNAME            (XML_PM_CTF_START + 0x0038)
-#define CTF_PM_FILLBITMAPNAME           (XML_PM_CTF_START + 0x0039)
-#define CTF_PM_FILLTRANSNAME            (XML_PM_CTF_START + 0x0040)
+#define CTF_PM_REPEAT_OFFSET_X          (XML_PM_CTF_START + 0x0037)
+#define CTF_PM_REPEAT_OFFSET_Y          (XML_PM_CTF_START + 0x0038)
+#define CTF_PM_FILLGRADIENTNAME         (XML_PM_CTF_START + 0x0039)
+#define CTF_PM_FILLHATCHNAME            (XML_PM_CTF_START + 0x0040)
+#define CTF_PM_FILLBITMAPNAME           (XML_PM_CTF_START + 0x0041)
+#define CTF_PM_FILLTRANSNAME            (XML_PM_CTF_START + 0x0042)
 
 #define CTF_PM_SCALETO                  (XML_PM_CTF_START + 0x0051) // calc specific
 #define CTF_PM_SCALETOPAGES             (XML_PM_CTF_START + 0x0052)
diff --git a/sc/qa/unit/data/ods/header-image.ods b/sc/qa/unit/data/ods/header-image.ods
new file mode 100644
index 0000000000000000000000000000000000000000..c19b902415dd02d787f3b365922c72ac6f840f5a
GIT binary patch
literal 12036
zcmb7K1zc2JuwP0V0YQ*%1*CiF?vzlvrCDG>Qlvvd2|+2PK`BA$r9?oaLE5Fe8<uzr
ze!^#b@Auy2ckbQ2?97=vXXZa~u9_keG64X91^_f=;>!lv352r(0D$uWzXh<jwzmL#
zfGkWvAUkU_6R@?T1Dl(JIjf_Ii?s`@Bgn$R+|kU{-ogRQ>H>1MFfn(rvakTF{lb$$
zey!u%bpYUe5W{(DTDjVrI+$47xv+tMeq;qXJPcD)k;TR!!GQk+TV75|1AeWAk25qx
z_?ekr41T_zA}=Mb>7Kl5AYOPw`MTXi7@@3j$fp<N55*)*+g@=MPs@eUlNL52+;>52
zr6jiIwAP6q@9f)GtYHf4`LxJ5DoimtF7N)R?(qqU@8-egv{NLs&Ubxl`%uI<mJ&MB
zS<V4#J+bh91f=*NEA2FsY0Am7rNk>q*r(N(xX2_d@HH>Y&xCWAf1sO(TIfACxbF4y
zfU%D0iE7zsiWKRbI{vgY=#Wb1x_t}w%JG47l|oH~Yyp}^Lu`L5z0vDE3~Dm6$Uxk=
z0*p7w%DS_As}+K>ZLzmi_XfSXiG%CYytk)YqS=ff$H#};tE1&bMs*@Og)HPLW>%Cf
zozZONv0vKV`@^XSh2$gkw@_?~a2p$X<j_pM=i`1E&eU>%Mu|FY?=BBILLoj!JBy2b
zIeHMh<|(unX%EQpq?roH<Bu5?(9LepS?|hs<g%mf=<Crdks|R=tc{I%A8bqxmp)7r
z^?kg*HvU$pC_Fl7^V#NYsQ20FiGETl{Jx5i<M$c?+1_uPb_iubLnZ6ONVdMVg3!+^
zwEGF0<BR+_eq@Br&tt>e`dhh%v9y$Ql+Ci=?#!^~gx5}+FFEDEv6bL2Tvn_x>TVTZ
zn{(PogB&zJC7SQ{INX|TiKgsgTVGqtmNyakRN2RuNWN>HHOc>y#A9gX6DI98njiC;
z_>L|+d#Eg06+<8`@)%l4=iQL&dm;yG$Lso;-|KuSwSZ8vpiaJ)2H&Z<eWPU6&e^=R
z)Xis3<w31CIg(n%%`z(jUV;La`_&hKJlQ}(La}D2dUa<BJ&!(gK?$bTu?pOgyD}J-
z97y)p{8DY-21*dyfA3;*G9z}?pZe@-Ljz9HaAlGS(B`rx8Fa~UWEWg&Q)qI6+eq<n
z7?I2z9wJ`~*<AmpdMXO)g;%&yxFFh3z)~`ip#&fbt#0m1?#Sgz7l;SwkYVcJrl2Tf
zOofSUTAkTnbAyh@xs52dRss!G$6qF?oGH+m*E)W*yy+xzTbUUe8t&!&G=<VA6$8`K
z?YH$e&1e3KO&wP%|8@*Qo&bzz02*K#FXj>DmAPqd<=ml<P=1y<aGNKik*eFpKAznk
zYXYziB_?+lo;}STfTF41Pc;`P)liel!w&}^KBbc$=|7hvSFs?N-BAl|)~<Kyq#l&Q
z=?NMmCO_B)DZ~^O-s57zLKGg<M(>Nf&Ogyh1bYN&s@pa=N?~)U_u=R_q(0t<nHDv@
zaVu(yb>-It5LVYY`MNARO68}`RNbuay~n0uy_!3ts;)qsL?!=L)kY>r{Pp|@lgS8i
zJwoBV!g~ckdLfg|PSd&=VyQ29;b4+0x$b3O%H`oxQHMvj=BVjgn&xq4>3)_C@hy!7
zLeYFv9J3Kly}vBfL)rE`mp<-lesxys$h6k)N`W-2<lbh+Zh>29ljUtg;+L{$V_@gR
zdpD2*+yh_3%~PU25_kEl^MP>yaMqg(4+zcmM*7E0oQ=jzaTh8-D%=U|nNx)L;rWow
zcu#xZxcwzfRULnhyr#J0LdR-o8661~cx{oh@-MiUQKaLT-pD1?$!TON`}mD82Uhjl
zplxdhsdX|Ge7}x0Pbxm;ow23t05L&!7nYXqU5b6BZgMeABJVZOlYPgURGWev4L&T|
z#%0E$oZ{!{l*Ffyw7qlhU!s3=sg31tlR%4|iFMc^?D1(W!=yC~@q-T9*$EIu$CI=M
zM--zLM-*odLP;;LBcFGR@P~abBHqN=n7<cCS0HkE&)N)tTA@;@@?l9c;#z@aFL&X*
z3e?!GKQ=yi+T3Qwr1S<`#8+Bm2jB%5iVI1=p^%JvLMGJJQoy^I%@u<Q*M>oP+H)=0
zkwO6?Kh7S3))Lv{2QwYa8$Fr|oz{Z`<5th^d*wf%Q6HVe{u0V?e4`}}&mUpZm}7u&
zF8CjW!&!%^$8bN*wA3U<_AD&G&qk-f0YRJ~4KhF|ASuPsp@XmTFc@zFI13Dl1g9YK
zR;yI9U1K1$zIP74lXYp1xrf0GlR#;C{hXRq&b3>ok2&b&t6%g-U<8PDeb8zwdlQIs
z3}ZZd{G~39M#%o0>WxDWcc8~xi8~KtwbyAwV5AwS=TB6(9`YgW*hlmXC%8kUhMhAS
zw_*{Fbqv?8ZK8<}27&^gkWznpIlIvSdG}-eoXo%z(DBMT>s`J)(qO#F3J&1LzGEDl
znpY4mPT}3`vVZ2N^btH32oQZ(FY{giI^iR_-(0>5ljetttr9l+ibBy)I{9SZY<D;n
z*Og1lCqCL}<h>AGf;xhCeSXa`+0mh$FIXKe=R9dq4w~xde*jD5;5|dtf*TknWgeoB
ze5bu#^n7n*5awT?)Zg$oNd?En#?%-$8W*gLCW}^qXPWW=hjK*`GTe1sT|EgM=Xv~S
z-kU4gk>v2&i?6x=U(4BV_+F<Dfj^@Je+54GNR8G{Q0wID<SU;|;x^vp!oDXbJe(=;
zdW$SHu6_tv{*|=GB^DuHM|For$FQ$Y1pOPmYuD$21NryV5Hwfd&g#;}$DSS?kPKJS
zl+>Y@o($^Mq%n5?UVy_m(KH($k@zYTV!U%q8fwi{QQyW6XgZ?|x(K~XEO)T~iM#{*
zZNbZN%LH7#u3svA54IWCiOkw#PfV>I0C~RRv~);@kxt4N-OfF?_|O4eZJ(!QdH<|B
zawP8$m}M$=4B3u^|6yOcuD4_d9~REJsZD=gsP`#>O=%k?pUV?Pnt^nd>i5U9rZ`66
z)U40@h}xOELc5mp!n&6kKcwPIKOfN1wq=eCwQ>ri8RwObp|M}Wgu`?{%d1QH@R`{-
zlckpX1Ab2Qb97x5+#9D-njh11gvQYlEOOtJ5C0**T8`4C3bv0nfMW{{a4AjgGGV61
zF17sOZ?9J8GXMu3MS!3b=afd7DiwqzgB<;wh%=;PVGM;B?X)ZR<9LEpV-)crt;T3&
zJ&a@@XTLe_laEs#o0~7~v8yi^_Qu)mr8Cu?k9CiT8n)=#U&i~>D8#E}wj0qg_GVw0
zkAV%(rMIF6!%Q<!eLG)!UqG*P-_P8uHk$0z5ZL#4>r~n4i~;-piBc1RhAOW$POcE@
zuC%OhTiCyZKR2zj;F!#Dhs#h^h3khjMnp=^?+}4Q#wUYn7~(}96-lrhJ$YifdZFBc
z+Dql0-zCjHnK>c#J^Nhor~)1i10t1<NNpe{pz|+q&x`#(#BE=Z-`(9y*kTO12o7Y8
zGU1PnE7&YYRM(!m8r>B#*^M6<QJ|&KC3_=RuKYYxF6rnTOI@F4Q-9SXln_WN^Q06w
z7BrfNV}y<O1wtIG&nKPSwSNa*_pr;j5B(DL41<%8HIVn|bN>fl#gZ-}^c!56q<xqD
z=JODJ;TdaB;gH+T_YT-7K}=sv6Ykk2BO?tmKasF1C1y-)#wxpYfzp>4GwsU%k9ki{
zD0Ex>69=7PZg8iWy--`0wq)Xu{Ac&EvAghjNQ0`ylpS3mek20fgf|>YPd}ev^Kvda
z>gN!LEyv~G>*Q-ZN4kS2Tgp<7T^U<3L0tDT`|e-bMGEJoU34us!J3s|ZLsE3p|Ofb
zKNs=zG!mAi?Mo}PSRj6pnVHrKFYo<_vo6Q=`0bz6tcOIJyFeNa;U0Pt2_uEuKI!!7
zWL@k+U99^kR6YWmKz}V-@=LfEv1djQdGts|I#|!@f2k_S26s``1UTBK$Axg*;DOD0
zHYtVMpmp&BtG@0a(d6Pt#d{F~MT^f2a=intSLV2hfO-IX97ktBpLH1;G4J!&9|p(p
z!*due*HHD2ei?GMsM<FU#>1Pr!b}RItAFI_4A+9&`lmG|;n7PU>N?cU^+Sx5bh^TO
z`6>eN2-L|p;C-Xv|AGedSTfg7DSlvOW5X|L>M41|xt`AxtD~2}jG3u+y<}=0I8qA6
zcK&o7G*_vJe+bgpd9r%$d~Y)^K?00`iOT;YiQOgO)!2F7<f`zjLM0ELve8~R`gzFM
z$?uOqeeRh4ZM8u8@fIX)|760GNg4cqNI>I0xhf3g8O(UY5eM?}+PR1JEnS)!O=XEt
zo3mxs>rf4Pg2gSOOE65(y#zy;-=sIK+<BBqc6>6EeFfw&QiUnF-NFrp%E{O4c<?-{
zKDWN(YQc9WGhI2yC!`JVm382|OxO)V&vRlK)C<f%<NI=votLv-nljXgeC_Et5g+W=
zXv0>nWB55k`;#+6d-^{){qMC!nkwUulJstNRpS`$IVgNt9i4<n$$-drbEIbm(UWz{
zJqOhk@LWRl;cGhU!I-PmG!FCxM!L^8B)893+Og*Nx#Ohc3{cEVZtO7i+6!K(1LUPu
zqzWaB{eSiX&@TE597IK-jmQ81gaQD-g8$0J0t~ixc<93FZg02xQqg6KANR>Rj9CNX
zfM>Ur=!c<ntI-yp)A&22?PEQOc^iEj@z%1==VuDULe$0&b3XDC71R5STf3H5HIJ9a
zhp@eP<|HNmpodj!77;%Q82YvS3#hx*M+>5LT9r|H>%B?a8@CB@8fP*L>YNSC%H$0V
zA$@H`83h8+Cq-oUX9<A@=^}L17FmO(ilio+NrW=y>e~9$#~LD(!IKv5uJXe|MTAeA
zk1fG`1KH-mb1mWF59@A9Gy32Wu!P1BqcP_$xr#j2X8ouD;ZzpSTUjZF?K3~pL)etX
zL0^#mSUCiV(qv}VFt-jfJ}~8(?XD`fl?kQAluQw4e+_w0N?>b*Lqii6?wN2#xJA7|
zn;d4>YBqzmk6Wcyap=rji_$YDoO`$%>2_Cm9zirD6iKIhI03n-Nw4eyZOYSv=pLeA
z`-iIXtchd3S@<4JE!>f>y*zQAl(l$;LkxN!Q4@^dt?6JA=e$!C!0(0KX7p^++uFfB
zv}&)RFTW$%6^Hf&CL)tANnYXjIN?3lF)63t%DV-xk#(#%OK-?GQ6z{1W?3L<6+){}
zgHTZ4grLv8&If|;p2w+o&SWQ5Kk8>9^!H@+S5~O?%gkKr!2=_Mid7@cj+gUz0WQR|
z-=MvYs)73kB)qpqR7Y=S5hJE+B4bXNZ22V=sXon|RMr*cE#pNOos<gWf(_@jSQ40F
z7SA9Zx1X`PeS9j7nE(FS1MsZ~1wXn+NeEwW9Ip~{FqnfgM9(TjDVu!LX_$Ac#SbV1
z(!brww!0o_O(3B=xu@_gr<`%c_L{ae0;|?_A=B<+6hB&6j8dQ-e%M#;Tiv6_vQ*}5
zs4&~E^u+zi)8|Ry&qNSTpO8Gktf=d;meR&@*tVC9d5MhVTnP=EEzi!sZTZ^gc#`B;
z$y>CTtV~Ks{UmO}nitoeVtSWw>V&7nKnC42I86uJZnUTA20uZI5#J{^#B1r;r>(V3
zv?x*3eVFv_Da|FwFF*uFdB;>dN**^i`{wpX^<G0T?{A%^&`%+7rn?}^@lkz5tM{{H
z!WOSupWb~Y>2@7iPE_w(rr#45ABc=_nmC2M(vp_0&Wl|2ehIvlN0K)uHukE*(Tr`g
z5WNcOwo&-JlQk>3KJJR16y-#EHa$!m;bAG$rQJ%(Gc#CUp!4={SjKj_BTA&LItVkw
zyVVg4TwQ)kl2_PpAj5NemBwnZ(V>u=YbW93ZA=%_3Y8md1!=lnRY!#*hE0#aXF0A~
zyB+d5LyK+eL4;{4SYzZ#g#(_AJgP4CU7IXjAcR}Og38Lyp3N#OSd{Co-+TCM>7ey)
z?XSnh_2Pj-dL8NwWFgW56t9$BOjMM7b&1!^?dAk2POWkJi-X?^XPlPB9huyZ2EP;S
zpC5qv<?njZnptwo)QbCXr{wAm=3b}Vsp25{rW5IuF~oDTZ|i}>E*&NQE1JQsL;l3H
zV9FyL+~NlFQAA<N_VvY(Gzv6bq#>O54THj%K<wdR`kOAkVDcULEPa`*FFBgkz|Zej
zLlGwhKiE7O!p&i$oA%@$&7Q`4E=~5OP3NP|nOp6F!|;xg6>I4lq_mQ&wQRbzg0TG{
zW-b|)^$F+pS-a}H!%WIF<}<*rST|#SzhVgq0O-d705IWLXXfYtK5vx5p{`a(F?y62
z7qYKI%+yV)Ec(8_&_*yJeZgeES2<u$?jG$^Y(@+^i{UefWUUh83uZcLw(q-N`I@4e
zJUsR{(`TlzK4YY;XY4u?vQW(f@eZviPc|2Iw#a;hj*I)OnfO12&1LzI;T5`s_!3#A
zj8^olW%SOJSZWXPKg6(Gaes%|D)^RPs%7^<<fp2)$@Yc;lD4Qse1k(~s2^AO&t^!-
zbZ-Z1xkL)z3?O-x<5{@btPo=pQN@&agZ3s7;}#q2j!R)EV?n;n1N(%L<b|Wz*`RMD
zsqE`c($?mY3j8SOr|gP@?L4c+7-UK9U1pLB9(hs5mLb6cdjoH8Ub`!?Q6<7LFMwfx
z?a)=EqqA_^n&zvJnWbCmz=TP@UF>1rdu0i|W_{jGNY@T_{BFzWGD}g!E3X$VI1<f~
zcPx!c#Y6UVms9iktio%vs~;4IbkBJ`DWqs*rX@=RbW%17#MVStXz%+6SMW$9`<1F5
zLPEW%RstJ>d6y{cV&w;YA+?ZgEP`sk=DL8e)&jFb7S7M2jWfz=xqcF)gQyHCQ18tT
zyu#&Q83o3HH6H^~m14$%Xi`|3dHto8IuY|JQEPXdL~6Q82=@9yt}PSpCPL^oD;+za
z$w!BAOPs2&c)O92SW$>4wUoYDZq`dCHfZ<;w7X@aP+W^Ne6o^XSJ!L6r+dSK;}-j(
zD<0~%rb?53i&Vk11)zKjg{*W}!FZLIBW&@}lIy2vWiqT)`G%_EFr0CR?j1x$FY$0e
zMEP5&F@S`<Vp~sdHbZWx@Vd_q6UexK(x9f4j2WBM2~|tNaKA_OUH9HRULl^$Q$O42
z+qYXeaEDm!=--i3VNCM#_H%KicZwV(j<9X;!SqG4361B}s&rA8y!dOElq#A@o7Bur
zf%mDGd?$AqDtfeY95#ty*x4^5L1(x4fbm`h$?+=F{DjH<kB>6niK6mNdX7_m(<t&H
zbU=Nt>CyinSVF@%($5KTg=S#02LO|ZdNLb~bJCO2a?>#Elj>fF^Y+eHtq#%GTpb-s
zPFz(ac#`t1`RX1f*QVl3dWv39rt-QUm^Eghq+{MDh@~rY%MLuOA+PSLzQLrA)bPwd
z<q7yh!h4OXo-BV%9zhQpJL=&Nvwfc1)kqFwQj5sK@{(hlw)tRA4&7$;+k<-1P1v#Y
zyhxxB0~hegaIY1AofnT`+4F(5*40y_YF@`RvE?0Gw!u$NK+j?V6IuDe3pb$iQIcs~
z8Kpf&(B7AK{VHtz<d(65S#-grn^8FA9?DL|f+MHp8D>ygyj~IoAaAOX1PC;_w>BS+
zz2uGy0=nY^H<NZYuKx-NS*DxDFA)F$MK~;6Y_C{=P0sNkGFCM@i5<6j{e+-({A~&L
zU4*B_8rOyG2NaaEzSEd?S=REnnSYIW4148k?Up1N9pUTvJ*gy*qO%~%u)+1qD;84@
zX*^<+EY22|qY_vI=8l?g?n+-Qetj0959a6To8C82@)i%g%cN_$#&}bfDy(%EDu~8X
z>)+u&R^D#2Dop;sS@&^a7<S{fIdQPNoY`_zV7!HVb{}E<RAY)~&TRz@L=u^hsN%%u
z@#Hs79dn=8Mwu7X5=S18dA?V?)6sfd+berJ3&JC2d=DR=7t&CK5gdI-_j8@DyZ@4F
zwOK^ft41``$m_^Brnxu1tZ}fgGrP$*_9d6zRpGOUu_$Y0a+Xw=Z*Y{yRM}3npl8{_
z&LVtJGEA7cH91wXGT#68^rM;4+VFn!RN8bo)25!)g3Vr(;TJA153!W%EWjcu?g1Z{
z?k7R3k=GT)UDTg^TescYKx{113UBQ_K)WWvw7ewi3fgcTxr1&S&gbO3pR45i{p{|R
zPpY&|{prlgP_#Lt{o;6zp><fS#gjS~=B>Hl)`Ge>r$|4S@5k<#xs`6hDSS8Te6YX~
zUCr7I?CNac!p6Z4KRDShF6`{w=ilH5H#@haG=~5`pY(rhZ;8Qqh@rvLVF19mQVV`Y
zekiUi4gi!yV;-BJz`rB7Xvj(c3OmUb;a{lC<TR8408a)0;7K3=a0I{gWB~whWd{J3
zi~#^(A^<=HO0H5Dg8u{2R8dw60LYJ|<%EAjca)KFfnTq|2R!d~(dvU=&_Qw!;5V@c
z&j*6Uoh0}3n{FWShw!Tse24*3IQU87LUf#Ox><c+9Trw?6eF(R^bPym@kw56dWr^e
z7w0iD(R3~zj}yp^Q(X){gX;5vGB@NdYh$_E4(7t#%xi=jU6TrW)+J~=_fzL@YOEa{
zPgL%(3WLo2nev<V#Cu$F3`9;B^ep`ATfxbO<y?1RDvs2`Tn@d7sO(aYN?P)iD=-!p
z+qk=r$MNUSI*;3KM!y0)AP|fw?)`qB(l}8QRTT1-=DKl72#stCHo@D~h=>n;j6zd!
zFOiCea*(}C+JeLZ5mkX$IlPm-Q~;UEhuXeibd$c41VE@u7dSu-ap|3l87=_*3%0}y
z{F|=5V<gC8z4YdHOx4X+*(ACUDEy_rQJ3A7LI%ibm}I{M*~5R!_6E=|k9va!QEZHU
zhQ9<IAt)5<by`%X{+;1KK|rd%ELpmm^+3D37Go{IcN7*R{!x$Z9v&dhQ~e&cM8hy!
zBBNgv#}}nV2{O>kZ7G~5PE4L*<*hLEYXEkcEDrK*vR#DNl*%}h71sf^N&-Rm*O0`{
zFk@e_Lx})%4>k<AFwig%(8K_UxK9AcRDgefJm|!RdPK30d+|?nK7M1*R70P8t9^v#
z9$(A;nRQ*%x-TGbB2uFE;I#;Rh3Uc4_rYfHZCkJfi#hxRI5%My4o((Mc1;dGAUi*h
zi<g<51IW(qIZI0Rlfd55+}hIPzX<q#5CqU#Cc_E-QU;=Zz?XFm<Z1f|x5g7n0009(
z25<p;*jZc@fm)jA03`OrKCScN>W&FOKwf}@C9*l3*X)A_j-&jzkJpQE30_<I#naO-
z^17MLzd_ZdVhnevt{36Nr*~2eLzEtN@;$+kfBtPTcR1aP8$Bj;y930}H{1TUIvJ?<
zmANte11T%wV1x80Q;kg9{p}pS??GN4Jiu)+fl}^-rMaC>)HMn#jD=*ztoiW_h2yV?
zn1h)#3NYfPZRpbpnVn1$we5El?6Y*@iYr$z#^!DwsC>0}F@(cbl~PxVSYBxs<>vB|
z{-)iCrRtFWTy?l7`Zmpr1i5FaHy_0j7=3eKkgD7|8FwfjN?{>ZJponfABEcxM%^uZ
zC!m$fzs1q)T>9lY(HqBNftyx^kMT#f^K!TKzCKL4hR(fV)8>SN%U>AL?%_WolyWeV
zU7BH=q>?D`1vicSA;uVXe5w26+~j8a?_^<ijdet)*ti2lNz0P@o8D`N_@f+JpX3E#
zi6rB54<jCE(FdrwWvyA`Cc};@gT9jot@Gn0mQVDky9ZjCvvh88WFWBaAWTjcV0i@0
zZFR@Sq#cqaL}0#^<E$I<b5*g=x1`DG%VWyB_G*itBFG>3P$ZLuF0!27{ZVh8Mayd4
z4q>iAT@+`a9~%cRN_|a;Y5ToV9DHq}5*0yvEN>lC6*_eF=8sEqR<c+Y*Kvn;p1lZE
z$=4ouNnARf6Aj7qc#kdi#x}F83Yu5#F~grdN{<CJ@TXa6=1-5OLr_m(QgqoV)pTAp
zypijrU^~yJDFzl7=IBoDJ{j?eP|&VjnA}NU21_Z{BupWyV5=Lg%4xac(&ORv2eC{^
z2@IsYfifT8KB^Td)WhVGE%KoUot6_;Ti(L!#74|8Hy^RH?~lH>7A%#lbr-Lba)BjP
zyC?(}g<*KqM{S+16>Xj}{fS?k$3B~<R6gT<KC)pTqbpDJEK>u7QPyHEo=gFe2$?}x
z8Ib|^vjQ7KyjT#~5tVhSbY)2fA<aFz)}sD2x%j|>J50SKSz;YFA8^G9ammVjV8g3V
zH(np4r&IP}n9UHk4t`Z5@eAJAI#GLPcSZmuC$bY~(iKc+SseEwH8>3wC5cImfAu_X
zn$bRIzo9{t{9T{WZ03d>H3(ycLq06Go-rgvcIMHeD4R}`8EEt>`L%gUM3;J&j0rXY
zHcZ25uQLA)I)QXUdFuP(v<rT+yFC4IrB#{<*FS_oq0*lR=0JCMhXTlO%DNnH@x)X&
zSQHlkMr-i29aLqy5)EQ~Vg+Dr-@0xP?!+~0c*oEocq=E?3)=Xf)v>)paM2t=zH6Gk
zj;SYQdpxr^tyyz_^g!A|p0wOO<zQ|8ORm?4h&T6)7L(l`CJcHpWiTo?Wpi24VsDvr
zw18AUP)U|YT2-m-CG8t4KJ}I(6$Pp0+u#L!Tq_@Qi>4KwTB@KVAEj6&#VsO5+MoZZ
zQRM*@H;$oyj`y~necKd=&&`gVFoQ1j$%@=vw&2{Gc8EQi_#g6)pdWxM?DAa1G1PCS
zLiCn*#OIcDb;r$*9t<b72gB-`<scbHg=_C?Xal0T?^ZCg)PxV{<A|VFa(UIS;?i21
z-pN8C<`FMz40vt@E=2StGcOuPJD6<rf^u8XhIz-+4i#mAa?+Q*1Zp_k52&7!I{E}O
z3-qx$3t16v3AGz**b0(U${2GIw9mAPtIR}3v}7gE+!-m=1<#*wUJsEhX~uDlFJhc<
zH|#Vu&KbK=jznZ>?7s%!rDKTj+xLokAq=!lCc2y2ZlcFRn~E4TB~|!{$Rl8_@H;2<
zjN)@K)s-0Mr|E3(+lfl@2>qKX-U=^J^p}NyBsR{JE6MoIR>&C@`vK-Bl|EOoB`HwR
zI*7WoEX3~HWdy-VAnGz=Q+QeVN^3>&!F=eu2}^80GCJdzgo9YksCpF1q81#suD&BH
zd+&4H&%~qamA_Oqt=o!dcB$!>@bjgr`o_3h3cX-URVA8l$B&?@&T&a^QbkaJZ-~H)
zCR{@$%LaLZ)^&kf8(g2}e7nj@V_Wv3N>og$<f53E3q~bK!U;TAw7WY$E>dJ%9|V>i
zRpgH?)M*8m%zf84FfceeX|~KFi+;bk62EEunO&pd1SHB+V-<ko3Zqi}F4QWy#N5xo
zJyP~9n_wk;jiJ64gM^wz_N#Mu%UsYY-Wit7T)n8}k>YGJjn*piE}uu2N4k?g+DP!i
ze2&j3IgUt`mkw9_L|=XbAnNu*r^F4G)_a3CcM!x6zGAZ0Y&4Fy?il5!$w;G*9Zx0p
z)%W-tXFXmClks;2rABq0RjIih^QzTW4Bbtze{BeRPVLD2ph$Ok_j|~GlB_Sn&lK`U
z1GH@4suu-b0R+H<+Ia)i-o(M$(!vGI>TGV=5!>Mqz>XWZE)-<ZIV8r0g5rGVOQlU(
zJx}m`6t=Bb_}?K>vD)gH`Acd2(}glz(5SMcRTHw-r|)wcG`Y<f>A%QXeOP1$R<l-S
zjRHr8J~C6jBHy$L$Vy|XdgQ<)VDuu0g%8WFt2F(N`>Sms)f$?H0e&Yrtj}dpXy_D?
z64tvj-XsE@Q|OjD>fq(q&ph_2grANB^IpHlF!`ua8}gCrxt~}hy3&_GZ~$4AiefX@
zi*0p*hBvEIEylHd0qH`<8_ZE%L*GNOvS$q^YKzzO1EAjVR-S8Sp00h(n^4*~<7Cb?
z)un1dkF)tx)~>T#Q$=NNQg&jU84r)1&6jOaYRMM;RM(G;`#gpCdBAf8fTW{?rS(Hs
z=ZiPdTsYaR?M)uS^KS`ju)PV$h3&tIN&Z3%c677@nK)S3{V#OqS<mm2f}9;6!n1xC
zQxoS)${(wHE-Jh>xHxXZ&%aZen3-AFS-_=tbY?Sib$0%z9fWk*Ir{Ud&)=B)osFfP
zBRpHXn*2|yzdf!C*aYnQi_m}4{cW~$HU0Zh|D^icY#>LFD+vB#pzEcI{-pccZ098Z
zp6!QXL+FZl#NcjI4=<Jo;Tlnv))Z%vSCL`6^dEQ?{XtXN5s@0Vc3;P?f*12GN8Wga
zC;Q%5zzITJih;cGP`&XEG-2F)AiJce-}%;Dz&-_5@qO}lZF>^|Zud*j+3sJ<)h{S1
z7;4#LNh=-LvNoY#x`r4(O{cibo;(&V9i0^`9)h10q!z<ufO=mL-g=9NF1PzF&KRI2
zzMsA4HfLMrCseTC;^KNEvQ1FFIy}slYQ8u~w>>$ETvN#{rAI-7>4w+4L#jlhrI|O|
zRLjLkR19m+-;Ybf!Zebotdh5IMwvCr;#opPe2EkR>HSIdeIAD54E)a)`W_)LhxD(X
z^;F!H6Cv9%U=FA7Pb9EbdfGtH{Em3luJ&b3rxEX2HvmZDe!LmYv9>%H+@6%5x;}Sb
z&<;#`0>I0bU_!YTvs|Or1A~s9@fDI%nuiW4PN=)MhIPlXeTp`+Iz&-ZL_j0}{P)YC
z7iN8V`uS?;?^M6P?s-W7(1d^dua`fsxcq&i=!%Om?yuWMzf=C+cD<rhf?JN+RTK7i
z!rz-SSA<5l;6VLPtLBR8hduw^6S$(HfY;9duMWXEYYL=u{i6Z?tdh>11zwE9N2cFH
z`1aYqYbKN*HPdhP(v_%xk3AO*FHR=(zeb`f%0Hd<9EPusXYg*s@9^{oDF13!SHu9o
zIdWVb9e-i=Z;<|PKIbrfb)dkp_jjRw1?``l{tnw$oJ9Y^=|4dHf798Iwfo67_%BSa
zApNIke`@|$W!3zJ%fBK1zxn(s&CXx=TtWVSbNN*oraOO8`M*NIfAjfO8q>e<xe5tC
lx%@pS{M0W1kO=4U*AStmh;q>c!w294rs1&!lj)r3e*h*op8Nm+

literal 0
HcmV?d00001

diff --git a/sc/qa/unit/subsequent_export-test.cxx b/sc/qa/unit/subsequent_export-test.cxx
index 33312e4..a6f273b 100644
--- a/sc/qa/unit/subsequent_export-test.cxx
+++ b/sc/qa/unit/subsequent_export-test.cxx
@@ -135,6 +135,7 @@ public:
     void testLinkedGraphicRT();
 
     void testSupBookVirtualPath();
+    void testHeaderImage();
 
     CPPUNIT_TEST_SUITE(ScExportTest);
     CPPUNIT_TEST(test);
@@ -180,6 +181,7 @@ public:
 #endif
     CPPUNIT_TEST(testSwappedOutImageExport);
     CPPUNIT_TEST(testLinkedGraphicRT);
+    CPPUNIT_TEST(testHeaderImage);
 
     CPPUNIT_TEST_SUITE_END();
 
@@ -2417,6 +2419,20 @@ void ScExportTest::testLinkedGraphicRT()
     }
 }
 
+void ScExportTest::testHeaderImage()
+{
+    // Graphic as header background was lost on export.
+    ScDocShellRef xShell = loadDoc("header-image.", ODS);
+    ScDocShellRef xDocSh = saveAndReload(&(*xShell), ODS);
+    uno::Reference<style::XStyleFamiliesSupplier> xStyleFamiliesSupplier(xDocSh->GetModel(), uno::UNO_QUERY);
+    uno::Reference<container::XNameAccess> xStyleFamilies = xStyleFamiliesSupplier->getStyleFamilies();
+    uno::Reference<container::XNameAccess> xPageStyles(xStyleFamilies->getByName("PageStyles"), uno::UNO_QUERY);
+    uno::Reference<beans::XPropertySet> xStyle(xPageStyles->getByName("Default"), uno::UNO_QUERY);
+    OUString aURL;
+    xStyle->getPropertyValue("HeaderBackGraphicURL") >>= aURL;
+    CPPUNIT_ASSERT(aURL.startsWith("vnd.sun.star.GraphicObject:"));
+}
+
 CPPUNIT_TEST_SUITE_REGISTRATION(ScExportTest);
 
 CPPUNIT_PLUGIN_IMPLEMENT();
-- 
2.4.3

