From c24777193352d95c46e87afaec5799845553edd2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
Date: Thu, 11 Aug 2022 09:06:49 +0100
Subject: [PATCH] turn off font combobox preview if
 SAL_ABORT_ON_NON_APPLICATION_FONT_USE set

Change-Id: Ib9c74599afb2b85564de85bf64340315ca0ba4f1
---
 sw/qa/inc/swmodeltestbase.hxx  |  1 +
 sw/qa/unit/swmodeltestbase.cxx | 11 ++++++++++-
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/sw/qa/inc/swmodeltestbase.hxx b/sw/qa/inc/swmodeltestbase.hxx
index 5b3cde89314f..c102e75422de 100644
--- a/sw/qa/inc/swmodeltestbase.hxx
+++ b/sw/qa/inc/swmodeltestbase.hxx
@@ -105,6 +105,7 @@ protected:
     sal_uInt32 mnStartTime;
     utl::TempFile maTempFile;
     bool mbExported; ///< Does maTempFile already contain something useful?
+    bool mbFontNameWYSIWYG;
 
 protected:
 
diff --git a/sw/qa/unit/swmodeltestbase.cxx b/sw/qa/unit/swmodeltestbase.cxx
index cdbdf6c391f5..374e18b6f799 100644
--- a/sw/qa/unit/swmodeltestbase.cxx
+++ b/sw/qa/unit/swmodeltestbase.cxx
@@ -21,6 +21,7 @@
 #include <comphelper/processfactory.hxx>
 #include <comphelper/propertyvalue.hxx>
 #include <comphelper/sequence.hxx>
+#include <officecfg/Office/Common.hxx>
 #include <rtl/ustrbuf.hxx>
 #include <sfx2/app.hxx>
 #include <unotools/mediadescriptor.hxx>
@@ -58,6 +59,7 @@ SwModelTestBase::SwModelTestBase(const OUString& pTestDocumentPath, const char*
     , mpFilter(pFilter)
     , mnStartTime(0)
     , mbExported(false)
+    , mbFontNameWYSIWYG(officecfg::Office::Common::Font::View::ShowFontBoxWYSIWYG::get())
 {
     maTempFile.EnableKillingFile();
 }
@@ -68,13 +70,20 @@ void SwModelTestBase::setUp()
     mxDesktop.set(
         css::frame::Desktop::create(comphelper::getComponentContext(getMultiServiceFactory())));
     SfxApplication::GetOrCreate();
+    std::shared_ptr<comphelper::ConfigurationChanges> xChanges(
+        comphelper::ConfigurationChanges::create());
+    officecfg::Office::Common::Font::View::ShowFontBoxWYSIWYG::set(false, xChanges);
+    xChanges->commit();
 }
 
 void SwModelTestBase::tearDown()
 {
     if (mxComponent.is())
         mxComponent->dispose();
-
+    std::shared_ptr<comphelper::ConfigurationChanges> xChanges(
+        comphelper::ConfigurationChanges::create());
+    officecfg::Office::Common::Font::View::ShowFontBoxWYSIWYG::set(mbFontNameWYSIWYG, xChanges);
+    xChanges->commit();
     test::BootstrapFixture::tearDown();
 }
 
-- 
2.37.1

